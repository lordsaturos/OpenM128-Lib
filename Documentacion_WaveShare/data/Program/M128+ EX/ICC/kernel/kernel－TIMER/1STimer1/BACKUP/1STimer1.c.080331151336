/*********************************************************************
	微 雪 电 子   WaveShare   http://www.waveShare.net            	
		                                                        
目    的:   建立使用Timer1做1S定时的示例程序
	
目标系统:   基于AVR单片机
		                                                                
应用软件:   ICCAVR
		                                                                
版    本:   Version 1.0                                                          
		                                                                
圆版时间:   2005-06-25
	
开发人员:   SEE

说    明:   若用于商业用途，请保留此段文字或注明代码来源
	
	深 圳 市 微 雪 电 子 有 限 公 司 保 留 所 有 的 版 权     
*********************************************************************/

/*01010101010101010101010101010101010101010101010101010101010101010101
---------------------------------------------------------------------
版本更新记录：

----------------------------------------------------------------------
实验内容：
使用TIMER1做1S定时，并使用PD口的LED指示灯做指示。
----------------------------------------------------------------------
硬件连接：	
将PD口的LED指示灯使能开关切换到"ON"状态。
----------------------------------------------------------------------
注意事项： 
（1）若有加载库函数，请将光盘根目录下的“库函数”下的“ICC_H”文件夹拷到D盘
（2）请详细阅读“使用必读”及相关资料。
		
----------------------------------------------------------------------
10101010101010101010101010101010101010101010101010101010101010101010*/

#include <iom16v.h>
#include <macros.h>

#define DISP_DDR   DDRD
#define DISP_PORT  PORTD

/*--------------------------------------------------------------------
函数名称：
函数功能：
注意事项：
提示说明：
输    入：
返    回：
--------------------------------------------------------------------*/
void timer1_init(void)
{
	TCCR1B = 0x00;		//stop timer

	TCNT1H = 0xE3;		//设置 TC1 的 计数寄存器 高8位值
	TCNT1L = 0xE1;		//设置 TC1 的 计数寄存器 低8位值

	//OCR1AH = 0x1C;	//设置 TC1 的 输出比较寄存器A 高8位值
	//OCR1AL = 0x20;	//设置 TC1 的 输出比较寄存器A 低8位值

	//OCR1BH = 0x1C;	//设置 TC1 的 输出比较寄存器B 高8位值
	//OCR1BL = 0x20;	//设置 TC1 的 输出比较寄存器B 低8位值

	//ICR1H  = 0x1C;	//设置 TC1 的 输入捕获寄存器 高8位值
	//ICR1L  = 0x20;	//设置 TC1 的 输入捕获寄存器 低8位值

	TCCR1A = 0x00;
	TCCR1B = 0x05;		//设置TC1 为 CLK/1024分频，启动TC1

	MCUCR = 0x00;		//设置 MCU 的 控制寄存器
	GICR  = 0x00;		//设置 中断控制寄存器
	TIMSK = 0x04;		//设置 定时计数器 的 屏蔽寄存器
	//SEI();			//enable interrupts
}
/*--------------------------------------------------------------------
函数名称：
函数功能：
注意事项：
提示说明：
输    入：
返    回：
--------------------------------------------------------------------*/
#pragma interrupt_handler timer1_ovf_isr:9
void timer1_ovf_isr(void)
{
	TCNT1H = 0xE3;		//reload counter high value
	TCNT1L = 0xE1;		//reload counter low value
	DISP_PORT++;
}
/*--------------------------------------------------------------------
函数名称：
函数功能：
注意事项：
提示说明：
输    入：
返    回：
--------------------------------------------------------------------*/
void main(void)
{
	DISP_DDR = 0XFF;
	timer1_init();
	SEI();
	while(1);
}


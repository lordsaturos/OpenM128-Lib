Interrupt Vectors
    00000 940C 0046 JMP	__text_start|__start
    00010 940C 0076 JMP	_timer1_ovf_isr

Program Code (text area)
__text_start|__start:
    00046 EFCF      LDI	R28,0xFF
    00047 E1D0      LDI	R29,0x10
    00048 BFCD      OUT	0x3D,R28
    00049 BFDE      OUT	0x3E,R29
    0004A 51C0      SUBI	R28,0x10
    0004B 40D0      SBCI	R29,0
    0004C EA0A      LDI	R16,0xAA
    0004D 8308      ST	Y,R16
    0004E 2400      CLR	R0
    0004F E0E0      LDI	R30,0
    00050 E0F1      LDI	R31,1
    00051 E011      LDI	R17,1
    00052 30E0      CPI	R30,0
    00053 07F1      CPC	R31,R17
    00054 F011      BEQ	0x0057
    00055 9201      ST	Z+,R0
    00056 CFFB      RJMP	0x0052
    00057 8300      ST	Z,R16
    00058 E8EC      LDI	R30,0x8C
    00059 E0F0      LDI	R31,0
    0005A E0A0      LDI	R26,0
    0005B E0B1      LDI	R27,1
    0005C E010      LDI	R17,0
    0005D E000      LDI	R16,0
    0005E BF0B      OUT	0x3B,R16
    0005F 38EC      CPI	R30,0x8C
    00060 07F1      CPC	R31,R17
    00061 F021      BEQ	0x0066
    00062 95C8      LPM
    00063 9631      ADIW	R30,1
    00064 920D      ST	X+,R0
    00065 CFF9      RJMP	0x005F
    00066 940E 0086 CALL	_main
_exit:
    00068 CFFF      RJMP	_exit
FILE: D:\DVK501_ICC\KERNEL~1\ATmega128\内核－TIMER\1STimer1\1STimer1.c
(0001) /*********************************************************************
(0002) 	微 雪 电 子   WaveShare   http://www.waveShare.net            	
(0003) 		                                                        
(0004) 目    的:   建立使用Timer1做1S定时的示例程序
(0005) 	
(0006) 目标系统:   基于AVR单片机
(0007) 		                                                                
(0008) 应用软件:   ICCAVR
(0009) 		                                                                
(0010) 版    本:   Version 1.0                                                          
(0011) 		                                                                
(0012) 圆版时间:   2005-06-25
(0013) 	
(0014) 开发人员:   SEE
(0015) 
(0016) 说    明:   若用于商业用途，请保留此段文字或注明代码来源
(0017) 	
(0018) 	深 圳 市 微 雪 电 子 有 限 公 司 保 留 所 有 的 版 权     
(0019) *********************************************************************/
(0020) 
(0021) /*01010101010101010101010101010101010101010101010101010101010101010101
(0022) ---------------------------------------------------------------------
(0023) 版本更新记录：
(0024) 
(0025) ----------------------------------------------------------------------
(0026) 实验内容：
(0027) 使用TIMER1做1S定时，并使用PD口的LED指示灯做指示。
(0028) ----------------------------------------------------------------------
(0029) 硬件连接：	
(0030) 将PD口的LED指示灯使能开关切换到"ON"状态。
(0031) ----------------------------------------------------------------------
(0032) 注意事项： 
(0033) （1）若有加载库函数，请将光盘根目录下的“库函数”下的“ICC_H”文件夹拷到D盘
(0034) （2）请详细阅读“使用必读”及相关资料。
(0035) 		
(0036) ----------------------------------------------------------------------
(0037) 10101010101010101010101010101010101010101010101010101010101010101010*/
(0038) 
(0039) #include <iom128v.h>
(0040) #include <macros.h>
(0041) 
(0042) #define DISP_DDR   DDRD
(0043) #define DISP_PORT  PORTD
(0044) 
(0045) /*--------------------------------------------------------------------
(0046) 函数名称：
(0047) 函数功能：
(0048) 注意事项：
(0049) 提示说明：
(0050) 输    入：
(0051) 返    回：
(0052) --------------------------------------------------------------------*/
(0053) void timer1_init(void)
(0054) {
(0055) 	TCCR1B = 0x00;		//stop timer
_timer1_init:
    00069 2422      CLR	R2
    0006A BC2E      OUT	0x2E,R2
(0056) 
(0057) 	TCNT1H = 0xE3;		//设置 TC1 的 计数寄存器 高8位值
    0006B EE83      LDI	R24,0xE3
    0006C BD8D      OUT	0x2D,R24
(0058) 	TCNT1L = 0xE1;		//设置 TC1 的 计数寄存器 低8位值
    0006D EE81      LDI	R24,0xE1
    0006E BD8C      OUT	0x2C,R24
(0059) 
(0060) 	//OCR1AH = 0x1C;	//设置 TC1 的 输出比较寄存器A 高8位值
(0061) 	//OCR1AL = 0x20;	//设置 TC1 的 输出比较寄存器A 低8位值
(0062) 
(0063) 	//OCR1BH = 0x1C;	//设置 TC1 的 输出比较寄存器B 高8位值
(0064) 	//OCR1BL = 0x20;	//设置 TC1 的 输出比较寄存器B 低8位值
(0065) 
(0066) 	//ICR1H  = 0x1C;	//设置 TC1 的 输入捕获寄存器 高8位值
(0067) 	//ICR1L  = 0x20;	//设置 TC1 的 输入捕获寄存器 低8位值
(0068) 
(0069) 	TCCR1A = 0x00;
    0006F BC2F      OUT	0x2F,R2
(0070) 	TCCR1B = 0x05;		//设置TC1 为 CLK/1024分频，启动TC1
    00070 E085      LDI	R24,5
    00071 BD8E      OUT	0x2E,R24
(0071) 
(0072) 	MCUCR = 0x00;		//设置 MCU 的 控制寄存器
    00072 BE25      OUT	0x35,R2
(0073) 	TIMSK = 0x04;		//设置 定时计数器 的 屏蔽寄存器
    00073 E084      LDI	R24,4
    00074 BF87      OUT	0x37,R24
    00075 9508      RET
_timer1_ovf_isr:
    00076 938A      ST	-Y,R24
    00077 939A      ST	-Y,R25
    00078 B78F      IN	R24,0x3F
    00079 938A      ST	-Y,R24
(0074) 	//SEI();			//enable interrupts
(0075) }
(0076) /*--------------------------------------------------------------------
(0077) 函数名称：
(0078) 函数功能：
(0079) 注意事项：
(0080) 提示说明：
(0081) 输    入：
(0082) 返    回：
(0083) --------------------------------------------------------------------*/
(0084) #pragma interrupt_handler timer1_ovf_isr:9
(0085) void timer1_ovf_isr(void)
(0086) {
(0087) 	TCNT1H = 0xE3;		//reload counter high value
    0007A EE83      LDI	R24,0xE3
    0007B BD8D      OUT	0x2D,R24
(0088) 	TCNT1L = 0xE1;		//reload counter low value
    0007C EE81      LDI	R24,0xE1
    0007D BD8C      OUT	0x2C,R24
(0089) 	DISP_PORT++;
    0007E B382      IN	R24,0x12
    0007F 5F8F      SUBI	R24,0xFF
    00080 BB82      OUT	0x12,R24
    00081 9189      LD	R24,Y+
    00082 BF8F      OUT	0x3F,R24
    00083 9199      LD	R25,Y+
    00084 9189      LD	R24,Y+
    00085 9518      RETI
(0090) }
(0091) /*--------------------------------------------------------------------
(0092) 函数名称：
(0093) 函数功能：
(0094) 注意事项：
(0095) 提示说明：
(0096) 输    入：
(0097) 返    回：
(0098) --------------------------------------------------------------------*/
(0099) void main(void)
(0100) {
(0101) 	DISP_DDR = 0XFF;
_main:
    00086 EF8F      LDI	R24,0xFF
    00087 BB81      OUT	0x11,R24
(0102) 	timer1_init();
    00088 DFE0      RCALL	_timer1_init
(0103) 	SEI();
    00089 9478      BSET	7
(0104) 	while(1);
FILE: <library>
    0008A CFFF      RJMP	0x008A
    0008B 9508      RET

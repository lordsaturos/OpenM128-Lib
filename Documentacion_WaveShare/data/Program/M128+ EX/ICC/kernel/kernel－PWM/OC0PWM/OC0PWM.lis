                        .module OC0PWM.C
                        .area text(rom, con, rel)
 0000                   .dbfile ..\..\..\..\KERNEL~1\ATmega128\内核－PWM\OC0PWM\OC0PWM.C
 0000                   .dbfile D:\DVK501_ICC\KERNEL~1\ATmega128\内核－PWM\OC0PWM\OC0PWM.C
 0000                   .dbfunc e timer0_init _timer0_init fV
                        .even
 0000           _timer0_init::
 0000                   .dbline -1
 0000                   .dbline 53
 0000           ; /*********************************************************************
 0000           ;       微 雪 电 子   WaveShare   http://www.waveShare.net              
 0000           ;                                                                       
 0000           ; 目    的:   建立使用OC0做PWM的示例程序
 0000           ;       
 0000           ; 目标系统:   基于AVR单片机
 0000           ;                                                                               
 0000           ; 应用软件:   ICCAVR
 0000           ;                                                                               
 0000           ; 版    本:   Version 1.0                                                          
 0000           ;                                                                               
 0000           ; 圆版时间:   2005-06-25
 0000           ;       
 0000           ; 开发人员:   SEE
 0000           ; 
 0000           ; 说    明:   若用于商业用途，请保留此段文字或注明代码来源
 0000           ;       
 0000           ;       深 圳 市 微 雪 电 子 有 限 公 司 保 留 所 有 的 版 权     
 0000           ; *********************************************************************/
 0000           ; 
 0000           ; /*01010101010101010101010101010101010101010101010101010101010101010101
 0000           ; ---------------------------------------------------------------------
 0000           ; 版本更新记录：
 0000           ; 
 0000           ; ----------------------------------------------------------------------
 0000           ; 实验内容：
 0000           ; 使用UserLed作为PWM口的监控，如果PWM低速则可以观察到UserLed的闪烁。
 0000           ; ----------------------------------------------------------------------
 0000           ; 硬件连接：    
 0000           ; 将UserLed指示灯连接至PB3/OC0。
 0000           ; ----------------------------------------------------------------------
 0000           ; 注意事项： 
 0000           ; （1）若有加载库函数，请将光盘根目录下的“库函数”下的“ICC_H”文件夹拷到D盘
 0000           ; （2）请详细阅读“使用必读”及相关资料。
 0000           ;               
 0000           ; ----------------------------------------------------------------------
 0000           ; 10101010101010101010101010101010101010101010101010101010101010101010*/
 0000           ; 
 0000           ; #include <iom128v.h> 
 0000           ; #include <macros.h> 
 0000           ; 
 0000           ; #define OC0_OUT_EN    DDRB |= 0b00001000
 0000           ; 
 0000           ; /*--------------------------------------------------------------------
 0000           ; 函数名称：
 0000           ; 函数功能：
 0000           ; 注意事项：
 0000           ; 提示说明：
 0000           ; 输    入：
 0000           ; 返    回：
 0000           ; --------------------------------------------------------------------*/
 0000           ; void timer0_init(void) 
 0000           ; { 
 0000                   .dbline 54
 0000           ;       TCCR0 = (1<<WGM01)|(1<<WGM00)|(1<<COM01)|(1<<COM00)|(1<<CS00);  
 0000 89E7              ldi R24,121
 0002 83BF              out 0x33,R24
 0004                   .dbline 60
 0004           ; /*
 0004           ;       WGM01=1; WGM00=1; --> fast PWM modle
 0004           ;       COM01=1; COM00=0; --> 比较匹配时set OC0 pin
 0004           ;       CS00=1;  --> timer0 source 不经过任何分频，直接为Clk，使得PWM可以工作得足够快
 0004           ; */
 0004           ;       TCNT0 = 0x00;                   //设置TC0计数寄存器初值 
 0004 2224              clr R2
 0006 22BE              out 0x32,R2
 0008                   .dbline 61
 0008           ;       OCR0  = 0x10;                   //输出比较寄存器初值，设置该值可用于调节占空比
 0008 80E1              ldi R24,16
 000A 81BF              out 0x31,R24
 000C                   .dbline -2
 000C           L1:
 000C                   .dbline 0 ; func end
 000C 0895              ret
 000E                   .dbend
 000E                   .dbfunc e main _main fV
                        .even
 000E           _main::
 000E                   .dbline -1
 000E                   .dbline 72
 000E           ; } 
 000E           ; /*--------------------------------------------------------------------
 000E           ; 函数名称：
 000E           ; 函数功能：
 000E           ; 注意事项：
 000E           ; 提示说明：
 000E           ; 输    入：
 000E           ; 返    回：
 000E           ; --------------------------------------------------------------------*/
 000E           ; void main(void) 
 000E           ; {
 000E                   .dbline 73
 000E           ;       OC0_OUT_EN;                             //为允许PWM工作，需设置PB3为输出
 000E BB9A              sbi 0x17,3
 0010                   .dbline 74
 0010           ;       timer0_init(); 
 0010 F7DF              xcall _timer0_init
 0012                   .dbline 75
 0012           ;       SEI(); 
 0012 7894              sei
 0014           L3:
 0014                   .dbline 76
 0014           ;       while(1);
 0014           L4:
 0014                   .dbline 76
 0014 FFCF              xjmp L3
 0016           X0:
 0016                   .dbline -2
 0016           L2:
 0016                   .dbline 0 ; func end
 0016 0895              ret
 0018                   .dbend
 0018           ; }

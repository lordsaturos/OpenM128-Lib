/*********************************************************************
	微 雪 电 子   WaveShare   http://www.waveShare.net            	
		                                                        
目    的:   建立使用DS18B20的示例程序
	
目标系统:   基于AVR单片机
		                                                                
应用软件:   ICCAVR
		                                                                
版    本:   Version 1.0                                                          
		                                                                
圆版时间:   2005-06-25
	
开发人员:   SEE

说    明:   若用于商业用途，请保留此段文字或注明代码来源
	
	深 圳 市 微 雪 电 子 有 限 公 司 保 留 所 有 的 版 权     
*********************************************************************/

/*01010101010101010101010101010101010101010101010101010101010101010101
----------------------------------------------------------------------
版本更新记录：

----------------------------------------------------------------------
实验内容：
通过DS18B20把转换出来的温度通过LCD12864显示出来
----------------------------------------------------------------------
硬件连接：将DS18B20与DVK500正确连接，并保证其接触良好
		  将STK162+的PA口与八个LED相连
		 	  DVK500				 STK162+
				VCC		---------	  VCC
				GND		---------	  GND
		 		DQ		---------	  PB2
				
			 DVK500				 	  STK128+
				CS		---------	  VCC
				PSB	    ---------	  GND
				SID		---------	  PB5
				CLK		---------	  PB7
----------------------------------------------------------------------
注意事项： 
（1）若有加载库函数，请将光盘根目录下的“库函数”下的“ICC_H”文件夹拷到D盘
（2）请详细阅读“使用必读”及相关资料。
----------------------------------------------------------------------
10101010101010101010101010101010101010101010101010101010101010101010*/
#include <iom162v.h>
#define NO_INCLUDE_I2C_H 1
#include "D:\ICC_H\CmmICC.H"
#include "D:\ICC_H\LCD12864_ST7920_M48.H"
/*DQ使用PB2口*/
#define DDRx DDRB
#define PORTx PORTB 
#define PINx PINB
#define ds18b20_dq 2
#include "D:\ICC_H\DS18B20_DVK501.H"
//----端口初始化----
void port_init(void)
{
    PORTA = 0x00;
    DDRA  = 0xFF;
    PORTB = 0xFF;
    DDRB  = 0xFF;
    PORTC = 0xFF; //m103 output only
    DDRC  = 0xFF;
    PORTD = 0xFF;
    DDRD  = 0xFF;
}
void main(void)
{	
	uchar tmp=0;
	port_init();
	
	lcd_init();
	lcd_clr();
	lcd_puts(1,1,"DS18B20-LCD12864");
	lcd_puts(2,1,"液晶显示温度");
	lcd_puts(3,1,"温度:   ℃");
	
	while(1)
	{
		delay50ms(20);
		tmp=read_temperature();
		lcd_putd(3,4,tmp,1);	//把转换出来温度通过lcd显示
	}
}
Interrupt Vectors
    00000 940C 0038 JMP	__text_start|__start
    00010 940C 0069 JMP	_timer1_ovf_isr

Program Code (text area)
__text_start|__start:
    00038 EFCF      LDI	R28,0xFF
    00039 E0D4      LDI	R29,4
    0003A BFCD      OUT	0x3D,R28
    0003B BFDE      OUT	0x3E,R29
    0003C 51C0      SUBI	R28,0x10
    0003D 40D0      SBCI	R29,0
    0003E EA0A      LDI	R16,0xAA
    0003F 8308      ST	Y,R16
    00040 2400      CLR	R0
    00041 E0E0      LDI	R30,0
    00042 E0F1      LDI	R31,1
    00043 E011      LDI	R17,1
    00044 30E0      CPI	R30,0
    00045 07F1      CPC	R31,R17
    00046 F011      BEQ	0x0049
    00047 9201      ST	Z+,R0
    00048 CFFB      RJMP	0x0044
    00049 8300      ST	Z,R16
    0004A E7E0      LDI	R30,0x70
    0004B E0F0      LDI	R31,0
    0004C E0A0      LDI	R26,0
    0004D E0B1      LDI	R27,1
    0004E E010      LDI	R17,0
    0004F E000      LDI	R16,0
    00050 BF0B      OUT	0x3B,R16
    00051 37E0      CPI	R30,0x70
    00052 07F1      CPC	R31,R17
    00053 F021      BEQ	0x0058
    00054 95C8      LPM
    00055 9631      ADIW	R30,1
    00056 920D      ST	X+,R0
    00057 CFF9      RJMP	0x0051
    00058 940E 0079 CALL	_main
_exit:
    0005A CFFF      RJMP	_exit
FILE: D:\DVK501_ICC\KERNEL~1\ATmega162\内核－TIMER\1STimer1\1STimer1.c
(0001) /*********************************************************************
(0002) 	微 雪 电 子   WaveShare   http://www.waveShare.net            	
(0003) 		                                                        
(0004) 目    的:   建立使用Timer1做1S定时的示例程序
(0005) 	
(0006) 目标系统:   基于AVR单片机
(0007) 		                                                                
(0008) 应用软件:   ICCAVR
(0009) 		                                                                
(0010) 版    本:   Version 1.0                                                          
(0011) 		                                                                
(0012) 圆版时间:   2005-06-25
(0013) 	
(0014) 开发人员:   SEE
(0015) 
(0016) 说    明:   若用于商业用途，请保留此段文字或注明代码来源
(0017) 	
(0018) 	深 圳 市 微 雪 电 子 有 限 公 司 保 留 所 有 的 版 权     
(0019) *********************************************************************/
(0020) 
(0021) /*01010101010101010101010101010101010101010101010101010101010101010101
(0022) ---------------------------------------------------------------------
(0023) 版本更新记录：
(0024) 
(0025) ----------------------------------------------------------------------
(0026) 实验内容：
(0027) 使用TIMER1做1S定时，并使用PD口的LED指示灯做指示。
(0028) ----------------------------------------------------------------------
(0029) 硬件连接：	
(0030) 将PD口的LED指示灯使能开关切换到"ON"状态。
(0031) ----------------------------------------------------------------------
(0032) 注意事项： 
(0033) （1）若有加载库函数，请将光盘根目录下的“库函数”下的“ICC_H”文件夹拷到D盘
(0034) （2）请详细阅读“使用必读”及相关资料。
(0035) 		
(0036) ----------------------------------------------------------------------
(0037) 10101010101010101010101010101010101010101010101010101010101010101010*/
(0038) #define NO_INCLUDE_I2C_H 1
(0039) #include <iom162v.h>
(0040) #include <macros.h>
(0041) 
(0042) #define DISP_DDR   DDRD
(0043) #define DISP_PORT  PORTD
(0044) 
(0045) /*--------------------------------------------------------------------
(0046) 函数名称：
(0047) 函数功能：
(0048) 注意事项：
(0049) 提示说明：
(0050) 输    入：
(0051) 返    回：
(0052) --------------------------------------------------------------------*/
(0053) void timer1_init(void)
(0054) {
(0055) 	TCCR1B = 0x00;		//stop timer
_timer1_init:
    0005B 2422      CLR	R2
    0005C BC2E      OUT	0x2E,R2
(0056) 
(0057) 	TCNT1H = 0xE3;		//设置 TC1 的 计数寄存器 高8位值
    0005D EE83      LDI	R24,0xE3
    0005E BD8D      OUT	0x2D,R24
(0058) 	TCNT1L = 0xE1;		//设置 TC1 的 计数寄存器 低8位值
    0005F EE81      LDI	R24,0xE1
    00060 BD8C      OUT	0x2C,R24
(0059) 
(0060) 	//OCR1AH = 0x1C;	//设置 TC1 的 输出比较寄存器A 高8位值
(0061) 	//OCR1AL = 0x20;	//设置 TC1 的 输出比较寄存器A 低8位值
(0062) 
(0063) 	//OCR1BH = 0x1C;	//设置 TC1 的 输出比较寄存器B 高8位值
(0064) 	//OCR1BL = 0x20;	//设置 TC1 的 输出比较寄存器B 低8位值
(0065) 
(0066) 	//ICR1H  = 0x1C;	//设置 TC1 的 输入捕获寄存器 高8位值
(0067) 	//ICR1L  = 0x20;	//设置 TC1 的 输入捕获寄存器 低8位值
(0068) 
(0069) 	TCCR1A = 0x00;
    00061 BC2F      OUT	0x2F,R2
(0070) 	TCCR1B = 0x05;		//设置TC1 为 CLK/1024分频，启动TC1
    00062 E085      LDI	R24,5
    00063 BD8E      OUT	0x2E,R24
(0071) 
(0072) 	MCUCR = 0x00;		//设置 MCU 的 控制寄存器
    00064 BE25      OUT	0x35,R2
(0073) 	GICR  = 0x00;		//设置 中断控制寄存器
    00065 BE2B      OUT	0x3B,R2
(0074) 	TIMSK = 0x04;		//设置 定时计数器 的 屏蔽寄存器
    00066 E084      LDI	R24,4
    00067 BF89      OUT	0x39,R24
    00068 9508      RET
_timer1_ovf_isr:
    00069 938A      ST	-Y,R24
    0006A 939A      ST	-Y,R25
    0006B B78F      IN	R24,0x3F
    0006C 938A      ST	-Y,R24
(0075) 	//SEI();			//enable interrupts
(0076) }
(0077) /*--------------------------------------------------------------------
(0078) 函数名称：
(0079) 函数功能：
(0080) 注意事项：
(0081) 提示说明：
(0082) 输    入：
(0083) 返    回：
(0084) --------------------------------------------------------------------*/
(0085) #pragma interrupt_handler timer1_ovf_isr:9
(0086) void timer1_ovf_isr(void)
(0087) {
(0088) 	TCNT1H = 0xE3;		//reload counter high value
    0006D EE83      LDI	R24,0xE3
    0006E BD8D      OUT	0x2D,R24
(0089) 	TCNT1L = 0xE1;		//reload counter low value
    0006F EE81      LDI	R24,0xE1
    00070 BD8C      OUT	0x2C,R24
(0090) 	DISP_PORT++;
    00071 B382      IN	R24,0x12
    00072 5F8F      SUBI	R24,0xFF
    00073 BB82      OUT	0x12,R24
    00074 9189      LD	R24,Y+
    00075 BF8F      OUT	0x3F,R24
    00076 9199      LD	R25,Y+
    00077 9189      LD	R24,Y+
    00078 9518      RETI
(0091) }
(0092) /*--------------------------------------------------------------------
(0093) 函数名称：
(0094) 函数功能：
(0095) 注意事项：
(0096) 提示说明：
(0097) 输    入：
(0098) 返    回：
(0099) --------------------------------------------------------------------*/
(0100) void main(void)
(0101) {
(0102) 	DISP_DDR = 0XFF;
_main:
    00079 EF8F      LDI	R24,0xFF
    0007A BB81      OUT	0x11,R24
(0103) 	timer1_init();
    0007B DFDF      RCALL	_timer1_init
(0104) 	SEI();
    0007C 9478      BSET	7
(0105) 	while(1);
FILE: <library>
    0007D CFFF      RJMP	0x007D
    0007E 9508      RET
